import React, { useState } from 'react';
import { ChevronUp, ChevronDown, Calendar, X } from 'lucide-react';

// Simulated widget data structure similar to your existing code
const dateFilterWidgets = [
  { type: 'today', amount: 0 },
  { type: 'last_7_days', amount: 0 },
  { type: 'last_30_days', amount: 0 },
  { type: 'last_90_days', amount: 0 },
  { type: '2021', amount: 0 },
  { type: '2020', amount: 0 },
  { type: '2019', amount: 0 },
];

// Simplified color theme - no background color by default, only on active
const activeTheme = {
  body: 'bg-transparent',
  text: 'text-gray-700',
  bodyActive: 'bg-gray-100',
  textActive: 'text-gray-900',
  hover: 'hover:bg-gray-50'
};

const DateFilterWidget = () => {
  const [open, setOpen] = useState(false);
  const [selectedFilter, setSelectedFilter] = useState('today');
  const [leftMonth, setLeftMonth] = useState(new Date());
  const [rightMonth, setRightMonth] = useState(() => {
    const date = new Date();
    date.setMonth(date.getMonth() + 1);
    return date;
  });

  const handleOpen = () => setOpen(true);
  const handleClose = () => setOpen(false);

  const handleFilterSelect = (type) => {
    setSelectedFilter(type);
  };

  const handleApply = () => {
    console.log('Applied filter:', selectedFilter);
    handleClose();
  };

  const getDaysInMonth = (date) => {
    const year = date.getFullYear();
    const month = date.getMonth();
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    const daysInMonth = lastDay.getDate();
    const startingDayOfWeek = firstDay.getDay();
    
    return { daysInMonth, startingDayOfWeek, year, month };
  };

  const changeLeftMonth = (increment) => {
    const newDate = new Date(leftMonth);
    newDate.setMonth(newDate.getMonth() + increment);
    setLeftMonth(newDate);
  };

  const changeRightMonth = (increment) => {
    const newDate = new Date(rightMonth);
    newDate.setMonth(newDate.getMonth() + increment);
    setRightMonth(newDate);
  };

  const renderCalendar = (currentDate, onMonthChange) => {
    const { daysInMonth, startingDayOfWeek, year, month } = getDaysInMonth(currentDate);
    
    const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
    const dayNames = ['Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa', 'Su'];
    
    const days = [];
    const adjustedStartDay = startingDayOfWeek === 0 ? 6 : startingDayOfWeek - 1;
    
    // Previous month's trailing days
    const prevMonthDays = new Date(year, month, 0).getDate();
    for (let i = adjustedStartDay - 1; i >= 0; i--) {
      days.push({ day: prevMonthDays - i, isCurrentMonth: false });
    }
    
    // Current month days
    for (let i = 1; i <= daysInMonth; i++) {
      days.push({ day: i, isCurrentMonth: true });
    }
    
    // Next month's leading days
    const remainingDays = 42 - days.length;
    for (let i = 1; i <= remainingDays; i++) {
      days.push({ day: i, isCurrentMonth: false });
    }

    return (
      <div className="flex-1 min-w-[280px]">
        <div className="flex items-center justify-between mb-3">
          <div className="font-semibold text-sm">
            {monthNames[month]} {year}
          </div>
          <div className="flex gap-1">
            <button 
              onClick={() => onMonthChange(-1)}
              className="p-1 hover:bg-gray-100 rounded transition-colors"
            >
              <ChevronUp size={18} />
            </button>
            <button 
              onClick={() => onMonthChange(1)}
              className="p-1 hover:bg-gray-100 rounded transition-colors"
            >
              <ChevronDown size={18} />
            </button>
          </div>
        </div>
        
        <div className="grid grid-cols-7 gap-1 mb-2">
          {dayNames.map(day => (
            <div key={day} className="text-center text-xs font-medium text-gray-600 py-1">
              {day}
            </div>
          ))}
        </div>
        
        <div className="grid grid-cols-7 gap-1">
          {days.map((dayObj, idx) => (
            <div
              key={idx}
              className={`text-center py-2 text-sm rounded cursor-pointer transition-colors
                ${dayObj.isCurrentMonth ? 'text-gray-900 hover:bg-gray-100' : 'text-gray-300'}`}
            >
              {dayObj.day}
            </div>
          ))}
        </div>
      </div>
    );
  };

  return (
    <div className="p-8">
      <button
        onClick={handleOpen}
        className="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
      >
        <Calendar size={20} />
        Open Date Filter
      </button>

      {open && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-white rounded-xl shadow-2xl max-w-4xl w-full mx-4 overflow-hidden">
            <div className="p-6">
              <div className="flex gap-6">
                {/* Left sidebar with filter options */}
                <div className="min-w-[140px] flex flex-col gap-2">
                  {dateFilterWidgets.map((widget) => {
                    const isSelected = selectedFilter === widget.type;
                    
                    return (
                      <div
                        key={widget.type}
                        onClick={() => handleFilterSelect(widget.type)}
                        className={`px-3 py-2.5 rounded-lg cursor-pointer text-sm font-medium transition-all capitalize
                          ${isSelected 
                            ? `${activeTheme.bodyActive} ${activeTheme.textActive}` 
                            : `${activeTheme.body} ${activeTheme.text} ${activeTheme.hover}`
                          }`}
                      >
                        {widget.type.replace(/_/g, ' ')}
                      </div>
                    );
                  })}
                </div>

                {/* Right side with dual calendars */}
                <div className="flex-1 flex gap-6 flex-wrap">
                  {renderCalendar(leftMonth, changeLeftMonth)}
                  {renderCalendar(rightMonth, changeRightMonth)}
                </div>
              </div>

              {/* Footer buttons */}
              <div className="flex justify-end gap-3 mt-6 pt-4 border-t border-gray-200">
                <button
                  onClick={handleClose}
                  className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium"
                >
                  Cancel
                </button>
                <button
                  onClick={handleApply}
                  className="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium"
                >
                  Apply
                </button>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default DateFilterWidget;
